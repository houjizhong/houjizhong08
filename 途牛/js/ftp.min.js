+function (e) {
    e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame;
    e.d = e.d instanceof Date ? e.d : new Date;
    var t = navigator.userAgent;
    var n = e.location.protocol;
    var o = {
        u: e.location.href,
        s: e.screen.width + "x" + e.screen.height,
        f: 0,
        l: 0,
        t: 0,
        o: 0,
        r: 0,
        a: 9,
        e: e.elk || ""
    };
    var a = document.cookie.match(new RegExp("(^| )deviceType=([^;]*)(;|$)"));
    if (a) {
        o.a = +a[2]
    }
    if (e.localStorage && e.localStorage.getItem("deviceType"))o.a = +e.localStorage.getItem("deviceType");
    if (/ipad/gi.test(t)) {
        o.a = 3
    }
    if (!/ipad|iphone|ipod|android|windows phone/gi.test(t)) {
        o.a = 4
    }
    if (n == "https:") {
        o.a = +o.a + 10
    }
    var i = 20;
    var r = new Date;
    var c = 0;
    var d = 0;
    var f = new Date;

    function l() {
        if (e.requestAnimationFrame) {
            e.requestAnimationFrame(function () {
                c++;
                var t = new Date;
                if (t - f > 1e3) {
                    var n = d * 1e3 / (t - f);
                    if (/fps/i.test(e.location.href))s(n);
                    if (n < o.l || o.l == 0) {
                        o.l = n >> 0;
                        o.t = document.body.scrollTop || document.documentElement.scrollTop || 0
                    }
                    f = t;
                    d = 0
                }
                d++;
                l()
            })
        }
    }

    function s(e) {
        var t = document.getElementById("FPS");
        if (!t) {
            t = document.createElement("div");
            t.style.cssText = "position:fixed;right:0px;top:0px;font-size:12px;color:#fff;background-color:#666;";
            t.id = "FPS";
            document.body.appendChild(t)
        }
        t.innerHTML = e
    }

    function u(e, t, n) {
        if (e.addEventListener) {
            e.addEventListener(t, n, false)
        } else {
            e.attachEvent("on" + t, n)
        }
    }

    u(e, "load", function () {
        o.o = new Date - e.d
    });
    var m = false;
    var p = function (e) {
        if (m)return;
        m = true;
        o.f = c * 1e3 / (new Date - r) >> 0;
        var t = new XMLHttpRequest;
        var a = [];
        for (var i in o) {
            a.push(i + "=" + encodeURIComponent(o[i]))
        }
        a = a.join("&");
        t.open("get", n + "//api.tuniu.com/stat/save?" + a, e || false);
        t.send(null)
    };
    u(e, "beforeunload", p);
    u(e, "unload", p);
    setTimeout(function () {
        p(true)
    }, 1e4);
    e.PERFORMANCE = o;
    l()
}(window);
